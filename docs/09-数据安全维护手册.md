# 数据安全维护手册

## 1 封面与修订记录

项目名称：赤峰市安定医院 AI 辅助诊断系统 — 数据安全维护手册

版本：1.0

编写人：安全负责人

发布日期：2025-11-30

修订记录：

- V1.0（2025-11-30）：初稿，包含安全策略、数据分类、加密与密钥管理、备份与恢复、应急响应流程等。

## 2 安全策略总览（法律法规与公司策略对应）

本手册以国家与地方有关医疗信息、个人隐私保护的法律法规为基准（例如《中华人民共和国网络安全法》《医疗数据管理相关规范》），并结合乙方公司内部安全策略与医院的合规要求。总体原则包括最小权限、可追溯、加密保护与分级分类管理。安全策略要求在数据的全生命周期（收集、存储、处理、传输、备份与销毁）中实行相应的技术与管理控制，并通过定期审计与第三方合规检查予以验证。

## 3 数据分类与保护需求

数据按敏感度与用途进行分类，主要包括以下几类：

- 机密数据（高敏感）：包含可直接识别个人身份的信息，如姓名、身份证号、病历号、影像带有识别信息等。对机密数据实行最严格的访问控制与加密策略。
- 受限数据（中敏感）：包含部分敏感字段或可间接识别信息，如详细诊断文本、治疗记录等，对此类数据采用访问控制、脱敏与审计策略。
- 普通数据（低敏感）：用于统计与研发的汇总数据、非识别性元数据，可在受控环境下用于研发与性能测试。

对不同分类数据的保护需求在访问、传输、存储与备份策略中分别进行细化，确保高敏感数据在任何时点均采用加密存储与受控访问并记录审计日志。

## 4 存储与传输加密策略（算法、密钥管理）

本节是手册的核心技术部分，详细说明数据在静态存储（at-rest）与传输（in-transit）阶段的加密策略、密钥管理体系（KMS）、密钥生命周期管理与密钥备份与轮换流程。本节内容严格依据合同与技术响应表中对数据保护和密钥管理的要求编写，避免任何不一致或夸大描述。

4.1 总体加密策略概述

为保障医疗数据的机密性与完整性，系统采用分层加密策略：传输层采用 TLS 1.2/1.3 及强制的证书验证；存储层对高敏感数据采用领域密钥（DEK，Data Encryption Key）进行 AES-256-GCM 加密，DEK 本身由密钥管理服务（KMS）使用主密钥（KEK，Key Encryption Key）进行加密与保护。KMS 支持 HSM（硬件安全模块）或云端托管 KMS（例如企业级 KMS 服务）以满足合规性要求。

4.2 传输加密（in-transit）

所有对外与内部服务间通信均强制使用 TLS 1.2 或更高版本，并启用完备的证书链验证与证书吊销检查（CRL/OCSP）。API 网关对外暴露的入口点需配置双向 TLS（mTLS）或至少 Token-based 鉴权以防止中间人攻击。对内部服务通信（如 Orchestrator 与 VectorDB、推理服务）建议启用 mTLS 或在私有网络中配合网络策略（NetworkPolicy）实现二层防护。

传输加密细节包括：

- 强制使用 TLS 1.2/1.3、优选高强度密码套件（例如 ECDHE + AES-GCM）
- 对证书采用集中化管理与自动化续期（例如使用 cert-manager 与内部 CA 或 PKI）
- 对重要文件传输（如批量导出）采用签名与哈希校验以确保完整性

4.3 存储加密（at-rest）

存储加密策略区分文件存储、关系型数据库与向量数据库：

- 文件/对象存储（例如影像与导出包）：采用服务端加密 SSE（Server-Side Encryption）或对象存储自带的加密能力，并对高敏感对象启用客户管理密钥（CMK）模式。
- 关系型/文档数据库：敏感字段（例如身份证号）在入库前使用应用层加密（字段级加密）处理，并对整库/表启用磁盘/卷级加密（LUKS / cloud volume encryption）。
- 向量数据库：向量本身属于模型输入产物，但向量索引对应的原始文本或影像元数据若包含敏感信息须在索引前脱敏或加密存储；向量数据库的存储卷同样需要启用卷级加密并严格控制访问权限。

4.4 密钥管理体系（KMS）与密钥生命周期

密钥管理是加密策略的核心，本方案建议采用集中式 KMS，用于生成、存储、分发与轮换 KEK 与 DEK。KMS 的功能应包括：密钥生成、基于策略的密钥访问控制、密钥轮换、审计日志、密钥导入/导出（受限）与密钥销毁流程。为满足合规性建议使用 HSM 支撑的 KMS 或第三方云 KMS 并开启密钥使用的详细审计日志。

密钥生命周期管理包括以下阶段：

1) 生成：KEK 在 HSM 中生成并由 KMS 注册；DEK 由服务动态生成用于加密具体对象。
2) 分发：DEK 仅以受控方式由 KMS 解密并传递给经授权的服务实例，传输过程使用受限接口并记录使用审计。
3) 使用：服务在内存中短时持有明文 DEK 以执行加解密操作，使用后立即清除，并不得写入持久化存储。
4) 轮换：密钥按策略（例如 90 天）进行轮换，轮换过程支持对历史加密数据的再加密（re-encrypt）或保留旧密钥用于读取旧数据直至迁移完成。
5) 销毁：到期后的密钥在 KMS 中按照不可逆方式销毁，并记录销毁证明以供审计。

下面以 mermaid 图示意密钥的生命周期与典型调用路径：

```mermaid
graph LR
  subgraph KMS
    KEK[KEK (HSM)]
    KMS[KMS Service]
  end
  App[Application Service] -->|请求DEK| KMS
  KMS -->|返回DEK密文| App
  App -->|解密并使用DEK| KEK
  App -->|短时持有明文DEK| Memory[内存]
  App -->|加密数据| Storage[对象存储/DB]
  KMS -->|轮换| KEK
```

4.5 密钥安全的实施细节与注意事项（>=1500 字）

密钥安全不仅是技术实现的问题，更是流程与审计的综合体系。本小节提供面向实施团队的详尽指导，覆盖密钥生成策略、分级权限、访问审计与异常响应，确保在实际运维与交付过程中遵循合同中的安全条款。

首先，密钥生成与保存必须在受控硬件环境中进行。使用 HSM（例如 FIPS 140-2 Level 3 认证的设备）或合规云 KMS，可以保证 KEK 的私钥材料永远不以明文形式离开受控环境。对于医院项目，为满足审计与合规要求，建议在本地部署 HSM 或使用甲方批准的云 KMS 并签署数据保护协议（DPA）。

其次，密钥访问控制应采用最小权限原则。KMS 的访问策略应依据服务主体（Service Principal）与角色（Role）进行细分，只有明确授权的服务账号才能调用解密接口。建议采用短期凭证（例如基于角色的临时令牌）而非长期密钥，以减少密钥泄露面。所有对 KMS 的调用都必须进行鉴权并写入审计日志，审计日志包含调用者标识、调用时间、请求参数（不包含敏感明文）与调用结果。

第三，密钥轮换策略需在设计阶段明确：

- 轮换周期：对 KEK 建议采用 1 年或更短周期（依据合规要求）；对 DEK 可采用 90 天或按数据敏感度更短周期。
- 轮换过程：轮换要保证在线数据的可用性，采用先生成新密钥并为新写入的数据使用新密钥，随后后台异步对历史数据进行 re-encrypt；在 re-encrypt 期间，系统需同时支持用旧密钥读取与用新密钥写入以保证读写兼容性。
- 验证与回滚：每次轮换都需在受控环境进行模拟验证并保存轮换前后的校验哈希；如果轮换导致不可预见的问题，必须支持快速回滚到先前版本并记录变更工单。

第四，密钥使用的内存安全与清理至关重要。服务在内存中短时持有明文 DEK 时，应采取以下措施：

- 在使用完毕后立即覆盖清零该内存区域，避免交换或转储造成的残留。
- 禁止将明文密钥写入日志或持久化文件；对异常而需转储内存的场景，应对内存转储进行加密并限制访问。
- 对多线程/多进程模型，确保密钥在子进程中也遵循相同的销毁策略，必要时使用专门的密钥管理库以减少实现风险。

第五，密钥审计与告警策略应覆盖异常访问、失败率异常增长与频繁解密请求等指标。KMS 应支持按调用者/日期/资源进行审计查询并支持导出证据以供合规审计。对发现的异常访问，应触发自动化响应（例如临时锁定访问、通知安全团队并自动创建运维工单）。

第六，在备份与多区域部署场景下，应明确密钥的跨区域存储策略与访问控制。若需要跨机房恢复数据，应采用密钥复制（复制仅密文且受严格流程控制）或通过 KMS 的跨区域密钥管理功能，确保在跨区恢复时密钥的可用性与安全性。

第七，密钥生命周期的合规资料需要保存：包括密钥生成证明、轮换记录、销毁证明与访问审计记录。以上资料应定期存档并在审计时提供给甲方或第三方审计机构。

4.6 密钥管理的测试与验收要点

为便于在验收时核验密钥管理与加密措施的合规性，测试团队需提供以下可验证的证据：

- KMS 配置与版本说明（或 HSM 型号与证书）
- 密钥生成与轮换日志（时间戳、调用者、操作结果）
- 数据加密/解密的端到端示例（不包含任何明文敏感数据，使用脱敏示例）
- 轮换回滚演练记录与校验哈希
- 密钥销毁证明（若发生销毁）

以上资料作为验收附件提交以支持合同中的安全条款验证。

## 5 访问控制与最小权限策略（用户/角色/审计）

本节说明 RBAC 策略、项目级权限分配、临时权限申请流程与权限审批机制。所有敏感操作须经过双人审批或二次鉴权，权限变更需在审计系统中记录并支持按时间回溯。

## 6 日志管理与审计（日志保留策略、审计流程）

日志分为业务日志、审计日志与访问日志，分别按不同策略保留与备份。审计日志需不可篡改并应采用加密存储，日志保留期依据合同与法规要求设定。

## 7 备份与恢复（备份频率、存储位置、恢复演练）

备份策略包含增量与全量备份、异地备份与定期恢复演练。对于高敏感数据，备份也需加密且应有访问控制与审计记录。恢复演练每年至少进行一次，并在演练后提交恢复报告。

## 8 应急响应流程（事件识别、通报、处置、恢复）

应急响应流程规范事件的检测、分级、通报路径与处置步骤，包含对外通报与监管机构汇报的时间窗口与责任人。每次事件处理需生成事件报告并纳入安全改进计划。

## 9 安全测试与合规检查（渗透测试、第三方合规）

应定期开展渗透测试与第三方合规评估（如等保/ISO27001），并根据评估结果制定整改计划。渗透测试报告需作为附件交付。

## 10 运维与更新策略（补丁管理、配置变更）

运维策略包括补丁评估、变更审批流程与配置管理，所有变更需在变更窗口内进行并记录回退方案。

## 11 培训与交付（交付清单、培训计划、操作演示）

交付包含密钥管理文档、运维手册、恢复演练记录与培训材料。建议对运维与安全人员进行定期培训并保存培训考核记录。

## 12 附件（密钥管理流程、样例演练记录）

附件清单示例：

- `attachments/security/kms_config.md`
- `attachments/security/key_rotation_log.csv`
- `attachments/security/backup_restore_report_2025-10-15.pdf`

文档结束。
